---
import cvEs from '../data/cv.json';
import cvEn from '../data/cv-en.json';

const nameEs = cvEs.hero.name;
const nameEn = cvEn.hero.name;
const aboutEs = cvEs.hero.about;
const aboutEn = cvEn.hero.about;

const getPara = (item: any) => Object.values(item)[0] as string;
---
<section id="about" class="py-10 px-6 transition-colors duration-300">
  <div class="max-w-5xl mx-auto 
    bg-zinc-50 border-zinc-200 
    dark:bg-zinc-900/40 dark:border-white/5 
    rounded-[3rem] p-8 md:p-16 relative overflow-hidden group shadow-sm dark:shadow-2xl">
    <div class="flex items-center gap-2 mb-16 justify-center">
      <h2 
        class="text-zinc-900 dark:text-white text-3xl font-bold tracking-tighter uppercase "
        data-es="Sobre Mí"
        data-en="About Me"
      >
        Sobre Mí
      </h2>
    </div>
    <div class="max-w-3xl mx-auto space-y-6">
      <p class="text-3xl md:text-4xl font-extrabold text-zinc-900 dark:text-white mb-8 tracking-tight"
        data-es={"¡Hola! Soy <span class='highlight'>" + nameEs + "</span>"}
        data-en={"Hello! I'm <span class='highlight'>" + nameEn + "</span>"}/>

      {aboutEs.map((item, index) => {
        const textEs = getPara(item);
        const textEn = getPara(aboutEn[index]);

        return (
          <p 
            class="text-zinc-700 dark:text-zinc-400 text-lg md:text-xl leading-relaxed about-text"
            data-es={textEs}
            data-en={textEn}
            set:html={textEs} 
          />
        );
      })}
    </div>
  </div>
</section>

<style is:global>
  .about-text .highlight {
    @apply font-bold text-zinc-900 dark:text-zinc-100;
    position: relative;
    text-decoration: underline;
    text-decoration-color: #0891b2; 
    text-underline-offset: 4px;
    text-decoration-thickness: 2px;
  }
</style>

<script>
  function setupAboutTranslation() {
    const update = () => {
      const lang = localStorage.getItem('lang') || 'es';
      document.querySelectorAll('#about [data-es]').forEach(el => {
        const text = el.getAttribute(`data-${lang}`);
        if (text) el.innerHTML = text; 
      });
    };

    window.addEventListener('language-changed', update);
    update();
  }
  setupAboutTranslation();
  document.addEventListener('astro:after-swap', setupAboutTranslation);
</script>